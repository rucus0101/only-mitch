! Command: show running-config
! device: cbl434 (AWE-5310, EOS-4.31.2F-36028628.gangesA1rel (engineering build))
!
! boot system flash:/EOS_Ganges_Signed.swi
!
aaa root secret sha512 $6$4ll9Ujk7E92KcbtC$xC78GF6A7eDaBa3Sc5vSTWj3c0fIMlISLAJEFc8Bw5v5wiiWUWYIHZS7e6K./WAoNMIrwovj8R5OoBIWH.2V.1
aaa authentication policy local allow-nopassword-remote-login
!
username admin privilege 15 role network-admin nopassword
username matt privilege 15 secret sha512 $6$1txNqQ4ghsueyoVh$XN1JLuqpMFw37QCurFviS8UyE2HKFpMKvqDHlRIagcwoESlXDjmcumwDtsx5VuznKC7owWNjoLMWGDof7JR0z1
!
prompt %H.%D{%H:%M:%S}%P
alias cc clear counters
alias senz show interface counter error | nz
alias shmc show int | awk '/^[A-Z]/ { intf = tg267 } /, address is/ { print intf, }'
alias snz show interface counter | nz
alias sqnz show interface counter queue | nz
alias srnz show interface counter rate | nz
!
load-interval default 1
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname cbl434
ip name-server vrf default 172.22.60.20
dns domain sjc.aristanetworks.com
!
router path-selection
   path-group ATT
      ipsec profile AUTOVPNTUNNEL
      !
      local interface Ethernet1/7
         stun server-profile profile1 profile2
      !
      peer dynamic
      !
      peer static router-ip 10.255.255.2
         ipv4 address 172.16.2.0
      !
      peer static router-ip 10.255.255.3
         ipv4 address 172.16.2.5
   !
   load-balance policy LBPOLICY
      path-group ATT
   !
   policy USAA_POLICY
      default-match
         load-balance LBPOLICY
   !
   policy dps-policy-default
      default-match
         load-balance LBPOLICY
   !
   vrf USAA
      path-selection-policy USAA_POLICY
   !
   vrf default
      path-selection-policy dps-policy-default
!
snmp-server community public ro
!
spanning-tree mode mstp
!
system l1
   unsupported speed action error
   unsupported error-correction action error
!
clock timezone US/Pacific
!
vrf instance USAA
!
management api http-commands
   no shutdown
!
aaa authorization exec default local
!
ip security
   ike policy IKEAUTOVPN
      local-id 10.255.255.7
   !
   sa policy SAAUTOVPN
   !
   profile AUTOVPNTUNNEL
      ike-policy IKEAUTOVPN 
      sa-policy SAAUTOVPN 
      connection start
      shared-key 7 0207165218120E
      dpd 2 10 clear
      mode transport
   !
   key controller
      profile AUTOVPNTUNNEL
!
interface Dps1
!
interface Ethernet1/1
!
interface Ethernet1/2
!
interface Ethernet1/3
!
interface Ethernet1/4
!
interface Ethernet1/5
   no switchport
   vrf USAA
   ip address 10.2.255.0/31
   ip ospf network point-to-point
!
interface Ethernet1/6
!
interface Ethernet1/7
   description ATT
   mtu 9000
   no switchport
   ip address 172.16.2.2/31
!
interface Ethernet1/8
!
interface Loopback0
   ip address 10.255.255.7/32
!
interface Management1/1
   ip address 172.28.138.221/20
!
interface Vxlan1
   vxlan source-interface Loopback0
   vxlan udp-port 4789
   vxlan vrf USAA vni 201
   vxlan vrf default vni 101
!
ip routing
ip routing vrf USAA
!
ip extcommunity-list SITE-OF-ORIGIN permit soo 65000:3
!
ip route 10.80.0.0/12 172.28.128.1
ip route 10.224.0.0/12 172.28.128.1
ip route 10.240.0.0/12 172.28.128.1
ip route 172.16.0.0/12 172.28.128.1
ip route 172.16.2.0/24 172.16.2.3
!
ntp server 172.22.60.22
!
route-map DENY-SOO deny 10
   match extcommunity SITE-OF-ORIGIN
!
route-map DENY-SOO permit 20
!
route-map MATCH_TAG deny 10
   match tag 10
!
route-map MATCH_TAG permit 20
   set extcommunity soo 65000:3 additive
!
route-map PERMIT_ALL permit 10
!
route-map SET_TAG permit 5
   match local-preference 5
   set metric 100
   set tag 10
!
route-map SET_TAG permit 10
   set tag 10
!
router bgp 65000
   router-id 10.255.255.7
   distance bgp 20 20 20
   maximum-paths 16
   neighbor PATHFINDER peer group
   neighbor PATHFINDER remote-as 65000
   neighbor PATHFINDER update-source Loopback0
   neighbor PATHFINDER bfd
   neighbor PATHFINDER bfd interval 1000 min-rx 1000 multiplier 3
   neighbor PATHFINDER send-community
   neighbor PATHFINDER maximum-routes 12000
   neighbor 10.255.255.2 peer group PATHFINDER
   neighbor 10.255.255.3 peer group PATHFINDER
   !
   address-family evpn
      neighbor PATHFINDER activate
      neighbor PATHFINDER route-map DENY-SOO in
   !
   address-family ipv4
      no neighbor PATHFINDER activate
   !
   address-family path-selection
      neighbor PATHFINDER activate
      neighbor PATHFINDER additional-paths receive
      neighbor PATHFINDER additional-paths send any
   !
   vrf USAA
      rd 10.255.255.7:1
      route-target import evpn 65000:1
      route-target export evpn 65000:1
      redistribute connected
      redistribute ospf route-map MATCH_TAG
      redistribute static
!
router ospf 1 vrf USAA
   router-id 10.255.255.7
   redistribute bgp route-map SET_TAG
   network 10.2.255.0/32 area 0.0.0.0
   max-lsa 12000
!
stun
   client
      refresh interval 10 seconds
      !
      server-profile profile1
         ip address 172.16.2.0
      !
      server-profile profile2
         ip address 172.16.2.5
!
end
